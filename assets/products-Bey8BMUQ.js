import{d as w,r as h,n as x}from"./index-ffCe8qSf.js";import{i as s}from"./indexedDBService-9HYV5ySC.js";import{u as A}from"./offers-BDDfGzaC.js";const c="products";function d(i){return Array.isArray(i)?[...i].map(String):typeof i=="string"&&i.trim()!==""?[i]:[]}const B=w("productsStore",()=>{const i=h([]),a=A();async function u(){const r=await s.getAll(c);i.value=r.map(e=>{const t=a.offers.find(n=>n.id===e.selectedOfferId);return{...e,allergens:d(e.allergens),finalPrice:t?a.calculatePrice(e.basePrice??0,t):e.basePrice??0}}).sort((e,t)=>e.order-t.order)}async function P(r){const e={...r,id:r.id||crypto.randomUUID(),order:r.order??i.value.length,allergens:d(r.allergens),basePrice:r.basePrice??0,finalPrice:r.finalPrice??r.basePrice??0,selectedOfferId:r.selectedOfferId??void 0,selectedOfferTitle:r.selectedOfferTitle??""};await s.put(c,e),i.value.push(e)}async function v(r,e){const t=i.value.findIndex(l=>l.id===r);if(t===-1)return;const n=i.value[t];if(e.selectedOfferId!==void 0){const l=a.offers.find(o=>o.id===e.selectedOfferId);e.selectedOfferTitle=l?.title||""}if(e.basePrice!==void 0||e.selectedOfferId!==void 0){const l=a.offers.find(o=>o.id===(e.selectedOfferId??n.selectedOfferId));e.finalPrice=l?a.calculatePrice(e.basePrice??n.basePrice??0,l):e.basePrice??n.basePrice??0}const f={...n,...e,allergens:d(e.allergens??n.allergens)};i.value[t]=f,await s.put(c,JSON.parse(JSON.stringify(f)))}async function m(r){await s.delete(c,r),i.value=i.value.filter(e=>e.id!==r)}async function g(r,e){if(e<0||e>=i.value.length)return;const t=i.value[r];i.value.splice(r,1),i.value.splice(e,0,t),await Promise.all(i.value.map((n,f)=>(n.order=f,s.put(c,n))))}async function O(){await Promise.all(i.value.map((r,e)=>(r.order=e,s.put(c,r)))),i.value.sort((r,e)=>r.order-e.order)}async function b(r){await s.put(c,r)}async function y(r){const e=i.value.find(t=>t.id===r);e&&(e.status=e.status==="visible"?"hidden":"visible",await s.put(c,e))}function I(r){return i.value.find(e=>e.id===r)}function S(){return{id:crypto.randomUUID(),name:"",description:"",calories:0,allergens:[],imageBlob:void 0,order:i.value.length,status:"visible",basePrice:0,finalPrice:0,selectedOfferId:void 0,selectedOfferTitle:""}}return x(()=>a.offers,()=>{i.value=i.value.map(r=>{const e=a.offers.find(t=>t.id===r.selectedOfferId);return{...r,finalPrice:e?a.calculatePrice(r.basePrice??0,e):r.basePrice??0}})},{deep:!0}),{products:i,load:u,addProduct:P,updateProduct:v,deleteProduct:m,moveProduct:g,saveOrder:O,directSave:b,toggleProductStatus:y,getProductById:I,createEmptyProduct:S}});export{B as u};
