import{u as h}from"./products-Bey8BMUQ.js";import{d as N}from"./vuedraggable.umd-BNcybpZs.js";import{a as b,r as _,f as I,c as i,m as k,h as S,b as t,o as a,_ as y,n as V,w as $,F as E,p as B,v as P,i as R,t as A,e as w,l as D,q as U,u as C,k as x}from"./index-ffCe8qSf.js";import"./indexedDBService-9HYV5ySC.js";import"./offers-BDDfGzaC.js";const F={class:"product-image"},O=["src","alt"],j=b({__name:"ProductImagePreview",props:{imageUrl:{},altText:{}},setup(g){const s=g,r=_(!1),c=_(!1),o=I(()=>s.imageUrl?.trim()||"");function e(){c.value=!0}return(m,p)=>(a(),i("div",F,[o.value&&!c.value?(a(),i("button",{key:0,onClick:p[0]||(p[0]=f=>r.value=!0),class:"preview-btn"}," 👁️ معاينة ")):k("",!0),r.value?(a(),i("div",{key:1,class:"popup",onClick:p[1]||(p[1]=S(f=>r.value=!1,["self"]))},[t("img",{src:o.value,alt:m.altText||"صورة المنتج",onError:e},null,40,O)])):k("",!0)]))}}),M=y(j,[["__scopeId","data-v-679dccb6"]]),q={class:"allergens-picker"},z={class:"tags"},G=["onClick"],H={key:0,class:"dropdown"},J=["onClick"],K=b({__name:"AllergensPicker",props:{modelValue:{}},emits:["update:modelValue"],setup(g,{emit:s}){const r=["الجلوتين","المحار","البيض","السمك","الفول السوداني","فول الصويا","الحليب","المكسرات","الكرفس","الخردل","السمسم","ثاني أكسيد الكبريت والكبريتات","البقوليات","الرخويات"],c=g,o=s,e=_(Array.isArray(c.modelValue)?c.modelValue:[]),m=_(""),p=_(!1);V(()=>c.modelValue,l=>{e.value=Array.isArray(l)?l:[]},{immediate:!0}),V(e,l=>{o("update:modelValue",l)});const f=I(()=>r.filter(l=>l.includes(m.value)&&!e.value.includes(l)));function v(l){e.value.includes(l)||e.value.push(l),m.value="",p.value=!1}function n(l){e.value=e.value.filter(u=>u!==l)}return(l,u)=>(a(),i("div",q,[t("div",{class:"input-wrapper",onClick:u[2]||(u[2]=d=>p.value=!0)},[t("div",z,[(a(!0),i(E,null,B(e.value,d=>(a(),i("span",{key:d,class:"tag"},[R(A(d)+" ",1),t("button",{type:"button",onClick:S(T=>n(d),["stop"])},"×",8,G)]))),128)),$(t("input",{type:"text","onUpdate:modelValue":u[0]||(u[0]=d=>m.value=d),placeholder:"اختر مسببات الحساسية",onFocus:u[1]||(u[1]=d=>p.value=!0)},null,544),[[P,m.value]])])]),p.value&&f.value.length?(a(),i("ul",H,[(a(!0),i(E,null,B(f.value,d=>(a(),i("li",{key:d,onClick:T=>v(d)},A(d),9,J))),128))])):k("",!0)]))}}),Q=y(K,[["__scopeId","data-v-c4e0d382"]]),W={class:"product-editor-row"},X={class:"field"},Y={class:"field"},Z={class:"field"},ee={class:"field"},te={class:"field"},le={key:0},oe={class:"action-buttons"},ne=b({__name:"ProductEditor",props:{edit:{}},emits:["save","cancel"],setup(g,{emit:s}){const r=g,c=s;function o(v){return Array.isArray(v)?[...v].map(String):typeof v=="string"&&v.trim()!==""?[v]:[]}const e=_({...r.edit,allergens:o(r.edit.allergens)}),m=I(()=>e.value.imageBlob?URL.createObjectURL(e.value.imageBlob):"");V(()=>r.edit,v=>{e.value={...v,allergens:o(v.allergens)}});function p(v){const n=v.target.files?.[0];n&&(e.value.imageBlob=n)}function f(){e.value.id||(e.value.id=crypto.randomUUID()),e.value.order===void 0&&(e.value.order=0),c("save",{...e.value,allergens:o(e.value.allergens)})}return(v,n)=>(a(),i("div",W,[t("div",X,[n[5]||(n[5]=t("label",null,"اسم المنتج",-1)),$(t("input",{"onUpdate:modelValue":n[0]||(n[0]=l=>e.value.name=l),required:""},null,512),[[P,e.value.name]])]),t("div",Y,[n[6]||(n[6]=t("label",null,"الوصف",-1)),$(t("input",{"onUpdate:modelValue":n[1]||(n[1]=l=>e.value.description=l)},null,512),[[P,e.value.description]])]),t("div",Z,[n[7]||(n[7]=t("label",null,"السعرات الحرارية",-1)),$(t("input",{"onUpdate:modelValue":n[2]||(n[2]=l=>e.value.calories=l),type:"number",min:"0"},null,512),[[P,e.value.calories,void 0,{number:!0}]])]),t("div",ee,[n[8]||(n[8]=t("label",null,"مسببات الحساسية",-1)),w(Q,{modelValue:e.value.allergens,"onUpdate:modelValue":n[3]||(n[3]=l=>e.value.allergens=l)},null,8,["modelValue"])]),t("div",te,[n[9]||(n[9]=t("label",null,"رفع صورة",-1)),t("input",{type:"file",accept:"image/*",onChange:p},null,32),e.value.imageBlob?(a(),i("div",le,[w(M,{imageUrl:m.value,altText:e.value.name},null,8,["imageUrl","altText"])])):k("",!0)]),t("div",oe,[t("button",{onClick:f},"💾 حفظ"),t("button",{onClick:n[4]||(n[4]=l=>c("cancel"))},"❌ إلغاء")])]))}}),L=y(ne,[["__scopeId","data-v-cf175ce4"]]),se={class:"product-row"},re={class:"field"},ae=["value"],ue={class:"field"},de=["value"],ie={class:"field"},ce=["value"],pe={class:"field"},ve=["value"],me={class:"image-preview"},fe={key:1},_e={class:"action-buttons"},ge=b({__name:"ProductRow",props:{product:{}},emits:["edit","delete"],setup(g,{emit:s}){const r=s;function c(o){const e=URL.createObjectURL(o);window.open(e,"_blank")}return(o,e)=>(a(),i("div",se,[t("div",re,[e[3]||(e[3]=t("label",null,"اسم المنتج:",-1)),t("input",{value:o.product.name||"بدون اسم",readonly:""},null,8,ae)]),t("div",ue,[e[4]||(e[4]=t("label",null,"الوصف:",-1)),t("input",{value:o.product.description||"لا يوجد وصف",readonly:""},null,8,de)]),t("div",ie,[e[5]||(e[5]=t("label",null,"السعرات الحرارية:",-1)),t("input",{value:o.product.calories?o.product.calories+" سعرة حرارية":"غير محدد",readonly:""},null,8,ce)]),t("div",pe,[e[6]||(e[6]=t("label",null,"مسببات الحساسية:",-1)),t("input",{value:o.product.allergens&&o.product.allergens.length?o.product.allergens.join(", "):"لا يوجد",readonly:""},null,8,ve)]),t("div",me,[e[7]||(e[7]=t("label",null,"الصورة:",-1)),t("div",null,[o.product.imageBlob?(a(),i("button",{key:0,onClick:e[0]||(e[0]=m=>c(o.product.imageBlob))}," 📷 معاينة ")):(a(),i("span",fe,"لا يوجد صورة"))])]),t("div",_e,[e[8]||(e[8]=t("button",{class:"drag-handle",title:"اسحب لتحريك"},"⠿",-1)),t("button",{onClick:e[1]||(e[1]=m=>r("edit",o.product))},"✏️"),t("button",{onClick:e[2]||(e[2]=m=>r("delete",o.product.id))},"🗑️")])]))}}),be=y(ge,[["__scopeId","data-v-2df0c2fd"]]),ye={class:"product-list"},ke={class:"product-container"},$e=b({__name:"ProductList",setup(g){const s=h(),r=_(null),c=_(s.createEmptyProduct()),o=_(!1);D(()=>{s.load()});function e(){c.value=s.createEmptyProduct(),r.value=null,o.value=!0}function m(l){r.value=l.id,o.value=!1}function p(){r.value=null,c.value=s.createEmptyProduct(),o.value=!1}function f(l){if(r.value)s.updateProduct(r.value,l);else{const u={...l,id:crypto.randomUUID(),order:s.products.length};s.addProduct(u)}p()}function v(l){s.deleteProduct(l)}async function n(){await Promise.all(s.products.map((l,u)=>(l.order=u,s.directSave(l)))),s.products.sort((l,u)=>l.order-u.order)}return(l,u)=>(a(),i("section",ye,[t("button",{class:"add-button",onClick:e},"➕ إضافة منتج جديد"),!r.value&&o.value?(a(),U(L,{key:0,edit:c.value,onSave:f,onCancel:p},null,8,["edit"])):k("",!0),w(C(N),{modelValue:C(s).products,"onUpdate:modelValue":u[0]||(u[0]=d=>C(s).products=d),"item-key":"id",handle:".drag-handle",onEnd:n},{item:x(({element:d})=>[t("div",ke,[r.value===d.id?(a(),U(L,{key:0,edit:d,onSave:f,onCancel:p},null,8,["edit"])):(a(),U(be,{key:1,product:d,onEdit:m,onDelete:v},null,8,["product"]))])]),_:1},8,["modelValue"])]))}}),Pe=y($e,[["__scopeId","data-v-858f489a"]]),we={class:"menu-content"},Ue=b({__name:"Products",setup(g){return(s,r)=>(a(),i("div",we,[t("section",null,[w(Pe)])]))}}),Ae=y(Ue,[["__scopeId","data-v-6d635616"]]);export{Ae as default};
