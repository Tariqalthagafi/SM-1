import{i as c}from"./indexedDBService-9HYV5ySC.js";import{a as w,r as d,f as A,l as C,c as a,b as r,F as h,p,t as n,V as F,m as f,i as L,o as t,_ as S}from"./index-ffCe8qSf.js";const x={key:0},B={class:"menu-preview-frame"},M={class:"section-title"},V=["src"],z={class:"product-info"},D={class:"product-name"},E={key:0,class:"allergen-icon"},I={class:"product-price"},N={key:0,class:"old-price"},$={class:"final-price"},O={key:0,class:"offer-label"},U={key:1},j=w({__name:"MenuPreview",setup(T){const _=d([]),m=d([]),v=d("grid"),y=d("ر.س");function b(l,u){const o=document.documentElement;Object.entries(u).forEach(([e,s])=>{o.style.setProperty(`--${e}-bg`,s),o.style.setProperty(`--${e}-color`,s)}),l.fontFamily&&o.style.setProperty("--font-family",l.fontFamily),y.value=l.currencySymbol==="svg-riyal"?"﷼":l.currencySymbol||"ر.س",v.value=l.layout_id||"grid"}const P=A(()=>{switch(v.value){case"grid":return"layout-grid";case"vertical":return"layout-vertical";case"cards":return"layout-cards";case"sectioned":return"layout-sectioned";default:return"layout-default"}});async function k(){const l=await c.getCustomization("template")||{},u=await c.getColors(l.colors_ref??"default")||{};b(l,u);const o=await c.getAll("offers");_.value=await c.getAll("sections");const e=await c.getAll("products");m.value=e.map(s=>{const i=o.find(g=>g.id===s.selectedOfferId&&g.isActive);return i?i.type==="percentage"?(s.finalPrice=Math.round((s.basePrice??0)*(1-i.discount/100)),s.offerLabel=`خصم ${i.discount}%`):i.type==="unifiedPrice"&&(s.finalPrice=i.discount,s.offerLabel="سعر موحد"):(s.finalPrice=s.basePrice??0,s.offerLabel=null),s.hasAllergens=Array.isArray(s.allergens)&&s.allergens.length>0,s})}return C(k),(l,u)=>_.value.length&&m.value.length?(t(),a("div",x,[r("div",B,[(t(!0),a(h,null,p(_.value,o=>(t(),a("div",{key:o.id,class:"menu-section"},[r("h5",M,n(o.name),1),r("div",{class:F(["products",P.value])},[(t(!0),a(h,null,p(m.value.filter(e=>e.sectionId===o.id&&e.status==="visible"),e=>(t(),a("div",{key:e.id,class:"product-item"},[e.imageUrl?(t(),a("img",{key:0,src:e.imageUrl,alt:"صورة المنتج",class:"product-image"},null,8,V)):f("",!0),r("div",z,[r("span",D,[L(n(e.name)+" ",1),e.hasAllergens?(t(),a("span",E,"⚠️")):f("",!0)]),r("span",I,[e.finalPrice!==e.basePrice?(t(),a("span",N,n(e.basePrice)+" "+n(y.value),1)):f("",!0),r("span",$,n(e.finalPrice)+" "+n(y.value),1)]),e.offerLabel?(t(),a("span",O,n(e.offerLabel),1)):f("",!0)])]))),128))],2)]))),128))])])):(t(),a("p",U,"جاري تحميل المنيو..."))}}),H=S(j,[["__scopeId","data-v-925af638"]]);export{H as default};
