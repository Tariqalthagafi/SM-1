const b=(t,e)=>e.some(n=>t instanceof n);let D,I;function O(){return D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function E(){return I||(I=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const w=new WeakMap,f=new WeakMap,m=new WeakMap;function C(t){const e=new Promise((n,o)=>{const i=()=>{t.removeEventListener("success",c),t.removeEventListener("error",r)},c=()=>{n(d(t.result)),i()},r=()=>{o(t.error),i()};t.addEventListener("success",c),t.addEventListener("error",r)});return m.set(e,t),e}function L(t){if(w.has(t))return;const e=new Promise((n,o)=>{const i=()=>{t.removeEventListener("complete",c),t.removeEventListener("error",r),t.removeEventListener("abort",r)},c=()=>{n(),i()},r=()=>{o(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",c),t.addEventListener("error",r),t.addEventListener("abort",r)});w.set(t,e)}let h={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return w.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function P(t){h=t(h)}function M(t){return E().includes(t)?function(...e){return t.apply(g(this),e),d(this.request)}:function(...e){return d(t.apply(g(this),e))}}function k(t){return typeof t=="function"?M(t):(t instanceof IDBTransaction&&L(t),b(t,O())?new Proxy(t,h):t)}function d(t){if(t instanceof IDBRequest)return C(t);if(f.has(t))return f.get(t);const e=k(t);return e!==t&&(f.set(t,e),m.set(e,t)),e}const g=t=>m.get(t);function v(t,e,{blocked:n,upgrade:o,blocking:i,terminated:c}={}){const r=indexedDB.open(t,e),l=d(r);return o&&r.addEventListener("upgradeneeded",a=>{o(d(r.result),a.oldVersion,a.newVersion,d(r.transaction),a)}),n&&r.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),l.then(a=>{c&&a.addEventListener("close",()=>c()),i&&a.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const N=["get","getKey","getAll","getAllKeys","count"],A=["put","add","delete","clear"],y=new Map;function S(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(y.get(e))return y.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,i=A.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(i||N.includes(n)))return;const c=async function(r,...l){const a=this.transaction(r,i?"readwrite":"readonly");let u=a.store;return o&&(u=u.index(l.shift())),(await Promise.all([u[n](...l),i&&a.done]))[0]};return y.set(e,c),c}P(t=>({...t,get:(e,n,o)=>S(e,n)||t.get(e,n,o),has:(e,n)=>!!S(e,n)||t.has(e,n)}));const x=["continue","continuePrimaryKey","advance"],j={},p=new WeakMap,_=new WeakMap,T={get(t,e){if(!x.includes(e))return t[e];let n=j[e];return n||(n=j[e]=function(...o){p.set(this,_.get(this)[e](...o))}),n}};async function*V(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,T);for(_.set(n,e),m.set(n,g(e));e;)yield n,e=await(p.get(n)||e.continue()),p.delete(n)}function B(t,e){return e===Symbol.asyncIterator&&b(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&b(t,[IDBIndex,IDBObjectStore])}P(t=>({...t,get(e,n,o){return B(e,n)?V:t.get(e,n,o)},has(e,n){return B(e,n)||t.has(e,n)}}));const z="menuDB",W=7,s=v(z,W,{upgrade(t){t.objectStoreNames.contains("products")||t.createObjectStore("products",{keyPath:"id"}),t.objectStoreNames.contains("sections")||t.createObjectStore("sections",{keyPath:"id"}),t.objectStoreNames.contains("offers")||t.createObjectStore("offers",{keyPath:"id"}),t.objectStoreNames.contains("social")||t.createObjectStore("social",{keyPath:"id"}),t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"id"}),t.objectStoreNames.contains("template_options")||t.createObjectStore("template_options",{keyPath:"id"}),t.objectStoreNames.contains("template_settings")||t.createObjectStore("template_settings",{keyPath:"id"}),t.objectStoreNames.contains("menu_colors")||t.createObjectStore("menu_colors",{keyPath:"id"}),t.objectStoreNames.contains("layout_templates")||t.createObjectStore("layout_templates",{keyPath:"id"}),t.objectStoreNames.contains("menu_customization")||t.createObjectStore("menu_customization",{keyPath:"id"})}}),F={async getAll(t){return(await s).getAll(t)},async get(t,e){return(await s).get(t,e)},async put(t,e){return(await s).put(t,e)},async delete(t,e){return(await s).delete(t,e)},async clear(t){return(await s).clear(t)},async getSetting(t){return(await(await s).get("template_settings","template"))?.[t]??null},async saveSetting(t,e){const n=await s,o=await n.get("template_settings","template")||{id:"template"};o[t]=e,await n.put("template_settings",o)},async getOptions(t){return(await(await s).getAll("template_options")).filter(o=>o.key===t&&o.is_active)},async saveOption(t){await(await s).put("template_options",t)},async getColors(t="default"){return(await s).get("menu_colors",t)},async saveColors(t,e="default"){await(await s).put("menu_colors",{id:e,...t})},async getLayoutTemplate(t){return(await s).get("layout_templates",t)},async getActiveLayoutTemplates(){return(await(await s).getAll("layout_templates")).filter(n=>n.is_active)},async saveLayoutTemplate(t){await(await s).put("layout_templates",t)},async getCustomization(t="template"){return(await s).get("menu_customization",t)},async saveCustomization(t,e="template"){await(await s).put("menu_customization",{id:e,...t})}};export{F as i};
